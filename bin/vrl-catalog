#!/bin/bash

display_usage() {
  echo -e "\nUsage: $0 [catalog]\n"
}

if [ $# -ne 1 ]
then
  display_usage
  exit 1
fi

catalog_name=$(eval "echo $1" | sed 's/\.pdf//')

if [[ $catalog_name != *.pdf ]];then
  echo -e "\nInput file must be a pdf\n"
  display_usage
  exit 1
fi
metatagger=inetpub/wwwroot/ipadapp/Antonio

echo "Creating directory..."
mkdir "$catalog_name"
mv "$1" "$catalog_name"
cd "$catalog_name"
echo "Converting to PNG..."
pdftoppm "$1" -scale-to-x 2048 -scale-to-y 1536 page -png 1>/dev/null 2>&1

echo "Rename pages..."
FILES="page-0*"
for f in $FILES
do
  removed_zero=$(eval "echo $f | perl -ne 's/(?<=-|0)0(?=[0-9])//g; print;'")
  mv $f $removed_zero
done

echo "Uploading to GoRack..."
cd ../
find "$catalog_name" -type f -exec curl --netrc --ftp-create-dirs -T {} "ftp://198.205.118.90/"$metatagger"/{}" \;

